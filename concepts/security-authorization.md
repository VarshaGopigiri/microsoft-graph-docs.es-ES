---
title: Autorización y API de seguridad de Microsoft Graph
description: Los datos de seguridad accesibles a través de la API de seguridad de Microsoft Graph son confidenciales y están protegidos por los permisos y los roles de Azure Active Directory (Azure AD).
author: preetikr
localization_priority: Priority
ms.prod: security
ms.openlocfilehash: e20a9abd036414eefc750fd667dbf7c1004b65bb
ms.sourcegitcommit: 36be044c89a19af84c93e586e22200ec919e4c9f
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 01/12/2019
ms.locfileid: "27947088"
---
# <a name="authorization-and-the-microsoft-graph-security-api"></a><span data-ttu-id="8f11f-103">Autorización y API de seguridad de Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="8f11f-103">Authorization and the Microsoft Graph Security API</span></span>

<span data-ttu-id="8f11f-104">Los datos de seguridad accesibles a través de la API de seguridad de Microsoft Graph son confidenciales y están protegidos por los permisos y los roles de Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="8f11f-104">Security data accessible via the Microsoft Graph Security API is sensitive and protected by both permissions and Azure Active Directory (Azure AD) roles.</span></span>

<span data-ttu-id="8f11f-105">La API de seguridad de Microsoft Graph admite dos tipos de autorización:</span><span class="sxs-lookup"><span data-stu-id="8f11f-105">The Microsoft Graph Security API supports two types of authorization:</span></span>

- <span data-ttu-id="8f11f-106">**Autorización a nivel de aplicación**: ningún usuario inició sesión (por ejemplo, un escenario SIEM).</span><span class="sxs-lookup"><span data-stu-id="8f11f-106">**Application-level authorization** - There is no signed-in user (for example, a SIEM scenario).</span></span> <span data-ttu-id="8f11f-107">Los permisos otorgados a la aplicación determinan la autorización.</span><span class="sxs-lookup"><span data-stu-id="8f11f-107">The permissions granted to the application determine authorization.</span></span> 
    ><span data-ttu-id="8f11f-108">**Nota:** esta opción también admite casos en los que la aplicación administra el Control de acceso basado en roles (RBAC).</span><span class="sxs-lookup"><span data-stu-id="8f11f-108">**Note:** This option can also support cases where Role-Based Access Control (RBAC) is managed by the application.</span></span>
- <span data-ttu-id="8f11f-109">**Autorización delegada por el usuario**: un usuario miembro del espacio empresarial de Azure AD ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="8f11f-109">**User delegated authorization** - A user who is a member of the Azure AD tenant is signed in.</span></span> <span data-ttu-id="8f11f-110">El usuario debe ser miembro de un rol de administrador limitado de Azure AD (ya sea lector o administrador de seguridad) y, además, la aplicación debe contar con los permisos necesarios.</span><span class="sxs-lookup"><span data-stu-id="8f11f-110">The user must be a member of an Azure AD Limited Admin role - either Security Reader or Securty Administrator - in addition to the application having been granted the required permissions.</span></span>

<span data-ttu-id="8f11f-111">Si realiza una llamada a la API de seguridad de Microsoft Graph desde Probador de Graph:</span><span class="sxs-lookup"><span data-stu-id="8f11f-111">If you're calling the Microsoft Graph Security API from Graph Explorer:</span></span>

- <span data-ttu-id="8f11f-112">El administrador del espacio empresarial de Azure AD debe conceder de forma explícita los permisos solicitados a la aplicación del Explorador de Graph.</span><span class="sxs-lookup"><span data-stu-id="8f11f-112">The Azure AD tenant admin must explicitly grant consent for the requested permissions to the Graph Explorer application.</span></span>
- <span data-ttu-id="8f11f-113">El usuario debe ser miembro del rol de administrador limitado del lector de seguridad en Azure AD (ya sea lector o administrador de seguridad).</span><span class="sxs-lookup"><span data-stu-id="8f11f-113">The user must be a member of the Security Reader Limited Admin role in Azure AD (either Security Reader or Security Administrator).</span></span>

><span data-ttu-id="8f11f-114">**Nota**: el Explorador de Graph no admite la autorización a nivel de aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-114">**Note**: Graph Explorer does not support application-level authorization.</span></span>

<span data-ttu-id="8f11f-115">Si realiza una llamada a la API de seguridad de Microsoft Graph desde una aplicación propia o personalizada:</span><span class="sxs-lookup"><span data-stu-id="8f11f-115">If you're calling the Microsoft Graph Security API from a custom or your own application:</span></span>

- <span data-ttu-id="8f11f-116">El administrador del espacio empresarial de Azure AD debe conceder de forma explícita los permisos a su aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-116">The Azure AD tenant admin must explicitly grant consent to your application.</span></span> <span data-ttu-id="8f11f-117">Esto es necesario tanto para las autorizaciones a nivel de aplicación y delegadas por usuarios.</span><span class="sxs-lookup"><span data-stu-id="8f11f-117">This is required both for application-level authorization and user delegated authorization.</span></span>
- <span data-ttu-id="8f11f-118">Si usa una autorización delegada por usuario, dicha persona debe ser miembro del rol de administrador limitado del lector o administrador de seguridad en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="8f11f-118">If you're using user delegated authorization, the user must be a member of the Security Reader or Security Administrator Limited Admin role in Azure AD.</span></span>

## <a name="manage-authorization-in-security-api-client-applications"></a><span data-ttu-id="8f11f-119">Administrar la autorización en las aplicaciones cliente con API de seguridad</span><span class="sxs-lookup"><span data-stu-id="8f11f-119">Manage authorization in security API client applications</span></span>

<span data-ttu-id="8f11f-120">Los datos de seguridad proporcionados a través de la API de seguridad de Microsoft Graph son confidenciales y deben estar protegidos por los mecanismos de autorización y autenticación adecuados.</span><span class="sxs-lookup"><span data-stu-id="8f11f-120">Security data provided via the Microsoft Graph Security API is sensitive and must be protected by appropriate authentication and authorization mechanisms.</span></span> <span data-ttu-id="8f11f-121">La siguiente tabla indica los pasos para registrarse y crear una aplicación cliente que puede acceder a la API de seguridad de Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="8f11f-121">The following table lists the steps to register and create a client application that can access the Microsoft Graph Security API.</span></span>

| <span data-ttu-id="8f11f-122">**Quién**</span><span class="sxs-lookup"><span data-stu-id="8f11f-122">**Who**</span></span> | <span data-ttu-id="8f11f-123">**Acción**</span><span class="sxs-lookup"><span data-stu-id="8f11f-123">**Action**</span></span> |
|:---------------------|:------------------|
|<span data-ttu-id="8f11f-124">Propietario o desarrollador de la aplicación</span><span class="sxs-lookup"><span data-stu-id="8f11f-124">Application developer or owner</span></span>|<span data-ttu-id="8f11f-125">Registra la aplicación como una aplicación de empresa.</span><span class="sxs-lookup"><span data-stu-id="8f11f-125">Register the application as an enterprise application.</span></span>|
|<span data-ttu-id="8f11f-126">Administrador de un espacio empresarial</span><span class="sxs-lookup"><span data-stu-id="8f11f-126">Tenant admin</span></span>|<span data-ttu-id="8f11f-127">Le concede permisos a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-127">Grant permissions to the application.</span></span>|
|<span data-ttu-id="8f11f-128">Administrador de un espacio empresarial</span><span class="sxs-lookup"><span data-stu-id="8f11f-128">Tenant admin</span></span>|<span data-ttu-id="8f11f-129">Asigna roles a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="8f11f-129">Assign roles to users.</span></span>|
|<span data-ttu-id="8f11f-130">Desarrollador de la aplicación</span><span class="sxs-lookup"><span data-stu-id="8f11f-130">Application developer</span></span>|<span data-ttu-id="8f11f-131">Inicia sesión como usuario y usa la aplicación para acceder a la API de seguridad de Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="8f11f-131">Sign in as the user and use the application to access the Microsoft Graph Security API.</span></span>|

<span data-ttu-id="8f11f-132">El registro de la aplicación solo define qué permisos necesita la aplicación para poder ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="8f11f-132">Application registration only defines which permissions the application needs in order to run.</span></span> <span data-ttu-id="8f11f-133">NO le concede los permisos a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-133">It does NOT grant these permissions to the application.</span></span>

<span data-ttu-id="8f11f-134">El administrador de espacios empresariales de Azure AD DEBE conceder de forma explícita los permisos a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-134">The Azure AD tenant administrator MUST explicitly grant the permissions to the application.</span></span> <span data-ttu-id="8f11f-135">Esto debe realizarse por espacio empresarial *cada vez* que se modifican los permisos de aplicación en el portal de registro correspondiente.</span><span class="sxs-lookup"><span data-stu-id="8f11f-135">This must be done per tenant and must be *performed every time* the application permissions are changed in the application registration portal.</span></span>

<span data-ttu-id="8f11f-136">Por ejemplo, imagine que tiene una aplicación, dos espacios empresariales de Azure AD (**E1** y **E2**) y dos permisos (**P1** y **P2**).</span><span class="sxs-lookup"><span data-stu-id="8f11f-136">For example, assume that you have an application, two Azure AD tenants, **T1** and **T2**, and two permissions, **P1** and **P2**.</span></span> <span data-ttu-id="8f11f-137">A continuación, se muestra el proceso de autorización:</span><span class="sxs-lookup"><span data-stu-id="8f11f-137">The following is the authorization process:</span></span>

- <span data-ttu-id="8f11f-138">La aplicación se registra para exigir el permiso **P1**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-138">The application registers to require permission **P1**.</span></span>
- <span data-ttu-id="8f11f-139">Cuando los usuarios del espacio empresarial **E1** obtienen un token de Azure AD para esta aplicación, el token no contiene ningún permiso.</span><span class="sxs-lookup"><span data-stu-id="8f11f-139">When users in tenant **T1** get an Azure AD token for this application, the token does not contain any permissions.</span></span>
- <span data-ttu-id="8f11f-140">El administrador de Azure AD del espacio empresarial **E1** concede de forma explícita permisos a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-140">The Azure AD admin of tenant **T1** explicitly grants permissions to the application.</span></span> <span data-ttu-id="8f11f-141">Cuando los usuarios del espacio empresarial **E1** obtienen un token de Azure AD para la aplicación, el token contendrá el permiso **P1**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-141">When users in tenant **T1** get an Azure AD token for the application, it will contain permission **P1**.</span></span>
- <span data-ttu-id="8f11f-142">Cuando los usuarios del espacio empresarial **E2** obtienen un token de Azure AD para la aplicación, el token no contiene ningún permiso, ya que el administrador del espacio empresarial **E2** todavía no le ha concedido permisos a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-142">When users in tenant **T2** get an Azure AD token for the application, the token does not contain any permissions - because the admin of tenant **T2** did not yet grant permissions to the application.</span></span> <span data-ttu-id="8f11f-143">Los permisos deben otorgarse *por espacio empresarial* y *por aplicación*.</span><span class="sxs-lookup"><span data-stu-id="8f11f-143">Permission must be granted *per tenant* and *per application*.</span></span>
- <span data-ttu-id="8f11f-144">El registro de la aplicación cambia para que ahora se requieran permisos **P1** y **P2**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-144">The application has its registration changed to now require permissions **P1** and **P2**.</span></span>
- <span data-ttu-id="8f11f-145">Cuando los usuarios del espacio empresarial **E1** obtienen un token de Azure AD para la aplicación, el token solo contendrá el permiso **P1**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-145">When users in tenant **T1** get an Azure AD token for the application, it only contains permission **P1**.</span></span> <span data-ttu-id="8f11f-146">Los permisos concedidos a una aplicación se registran como instantáneas de lo que se le ha concedido: *no cambian automáticamente* después de que cambie el registro (permiso) de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-146">Permissions granted to an application are recorded as snapshots of what was granted - they *do not change automatically* after the application registration (permission) changes.</span></span>
- <span data-ttu-id="8f11f-147">El administrador del espacio empresarial **E2** le concede permisos **P1** y **P2** a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-147">The admin of tenant **T2** grants permissions **P1** and **P2** to the application.</span></span> <span data-ttu-id="8f11f-148">Ahora bien, cuando los usuarios del espacio empresarial **E2** obtienen un token de Azure AD para la aplicación, el token contendrá los permisos **P1** y **P2**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-148">Now, when users in tenant **T2** get an Azure AD token for the application, the token will contain permissions **P1** and **P2**.</span></span>

><span data-ttu-id="8f11f-149">**Nota**: Los tokens de Azure AD para la aplicación en el espacio empresarial **E1** y **E2** contienen diferentes permisos, ya que cada administrador del espacio empresarial ha concedido diferentes permisos a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-149">**Note**: The Azure AD tokens for the application in tenant **T1** and the application in tenant **T2** contain different permissions, because each tenant admin has granted different permissions to the application.</span></span>

- <span data-ttu-id="8f11f-150">Para que la aplicación vuelva a funcionar en el espacio empresarial **E1**, el administrador del espacio **E1** debe concederle los permisos **P1** y **P2** de forma explícita a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-150">To make the application work again in tenant **T1**, the admin of tenant **T1** must explicitly grant permissions **P1** and **P2** to the application.</span></span>

## <a name="register-an-application-in-the-azure-ad-v20-endpoint"></a><span data-ttu-id="8f11f-151">Registrar una aplicación con el punto de conexión de Azure AD (versión 2.0)</span><span class="sxs-lookup"><span data-stu-id="8f11f-151">Register an application in the Azure AD v2.0 endpoint</span></span>

<span data-ttu-id="8f11f-152">Para registrar una aplicación con el punto final de Azure AD (versión 2.0), necesitará lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="8f11f-152">To register an application to the Azure AD v2.0 endpoint, you'll need:</span></span>

- <span data-ttu-id="8f11f-153">**Nombre de la aplicación**: una cadena que se usa para el nombre de aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-153">**Application name** - A string used for the application name.</span></span>
- <span data-ttu-id="8f11f-154">**Dirección URL de redirección**: la dirección URL desde donde se envía la respuesta de autenticación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="8f11f-154">**Redirect URL** - The URL where the authentication response from Azure AD is sent.</span></span> <span data-ttu-id="8f11f-155">Para comenzar, puede usar la página principal de prueba de la aplicación web del cliente.</span><span class="sxs-lookup"><span data-stu-id="8f11f-155">To start, you can use the test client web app homepage.</span></span>
- <span data-ttu-id="8f11f-156">**Permisos necesarios**: los permisos que necesita su aplicación para poder realizar una llamada a Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="8f11f-156">**Required Permissions** - The permissions that your application requires to be able to call Microsoft Graph.</span></span>

<span data-ttu-id="8f11f-157">Para registrar su aplicación, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="8f11f-157">To register your application:</span></span>

1. <span data-ttu-id="8f11f-158">Vaya a https://apps.dev.microsoft.com/ e inicie sesión.</span><span class="sxs-lookup"><span data-stu-id="8f11f-158">Go to https://apps.dev.microsoft.com/ and sign in.</span></span>
    ><span data-ttu-id="8f11f-159">**Nota**: No necesita ser administrador de espacios empresariales. Se lo redirigirá a la lista **Mis aplicaciones**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-159">**Note**: You don't have to be a tenant admin. You will be redirected to the **My applications** list.</span></span>
2. <span data-ttu-id="8f11f-160">Elija **Agregar una aplicación** y escriba un **Nombre de la aplicación** para crear una nueva aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-160">Choose **Add an app**, and enter an **Application Name** to create a new application.</span></span>
3. <span data-ttu-id="8f11f-161">En la página de registro de la nueva aplicación, elija **Agregar plataforma** > **Web**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-161">On the registration page for the new application, choose **Add Platform** > **Web**.</span></span> <span data-ttu-id="8f11f-162">En el campo **Dirección URL de redireccionamiento**, escriba la URL correspondiente.</span><span class="sxs-lookup"><span data-stu-id="8f11f-162">In the **Redirect URL** field, enter the redirect URL.</span></span>
4. <span data-ttu-id="8f11f-163">En la sección **Permisos para Microsoft Graph**, debajo de **Permisos delegados**, elija **Añadir**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-163">In the **Microsoft Graph Permissions** section, under **Delegated Permissions**, choose **Add**.</span></span> <span data-ttu-id="8f11f-164">En el cuadro de diálogo, elija los permisos necesarios.</span><span class="sxs-lookup"><span data-stu-id="8f11f-164">In the dialog box, choose the required permissions.</span></span> <span data-ttu-id="8f11f-165">Para obtener una lista de permisos, consulte [Permisos de seguridad](permissions-reference.md#security-permissions).</span><span class="sxs-lookup"><span data-stu-id="8f11f-165">For a list of permissions, see [Security permissions](permissions-reference.md#security-permissions).</span></span>

    ><span data-ttu-id="8f11f-166">La API de seguridad de Microsoft Graph requiere el ámbito SecurityEvents.Read.All para las consultas GET y el ámbito SecurityEvents.ReadWrite.All para las consultas PATCH/POST.</span><span class="sxs-lookup"><span data-stu-id="8f11f-166">The Microsoft Graph Security API requires the SecurityEvents.Read.All scope for GET queries, and the SecurityEvents.ReadWrite.All scope for PATCH/POST queries.</span></span>

5. <span data-ttu-id="8f11f-167">Seleccione **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-167">Choose **Save**.</span></span>

<span data-ttu-id="8f11f-168">Guarde la siguiente información:</span><span class="sxs-lookup"><span data-stu-id="8f11f-168">Save the following information:</span></span>

- <span data-ttu-id="8f11f-169">Id. de aplicación</span><span class="sxs-lookup"><span data-stu-id="8f11f-169">Application ID</span></span>
- <span data-ttu-id="8f11f-170">Dirección URL de redireccionamiento</span><span class="sxs-lookup"><span data-stu-id="8f11f-170">Redirect URL</span></span>
- <span data-ttu-id="8f11f-171">Lita de permisos necesarios</span><span class="sxs-lookup"><span data-stu-id="8f11f-171">List of required permissions</span></span>

<span data-ttu-id="8f11f-172">Para obtener más información, consulte [Registrar una aplicación con el punto de conexión v2.0 de Azure AD](auth-register-app-v2.md).</span><span class="sxs-lookup"><span data-stu-id="8f11f-172">For more information, see [Register your app with the Azure AD v2.0 endpoint](auth-register-app-v2.md).</span></span>

## <a name="grant-permissions-to-an-application"></a><span data-ttu-id="8f11f-173">Conceda permisos a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-173">Grant permissions to an application</span></span>

<span data-ttu-id="8f11f-174">El registro de la aplicación solo define qué permisos necesita la aplicación y no le concede los permisos.</span><span class="sxs-lookup"><span data-stu-id="8f11f-174">Application registration only defines which permission the application requires - it does not grant these permissions to the application.</span></span> <span data-ttu-id="8f11f-175">Un administrador de espacios empresariales de Azure AD explícitamente debe conceder estos permisos de forma explícita mediante una llamada al punto de conexión de consentimiento de administrador.</span><span class="sxs-lookup"><span data-stu-id="8f11f-175">An Azure AD tenant administrator must explicitly grant these permissions by making a call to the admin consent endpoint.</span></span> <span data-ttu-id="8f11f-176">Para obtener más información, consulte [Usar el punto de conexión de consentimiento de administrador](https://docs.microsoft.com/es-ES/azure/active-directory/develop/active-directory-v2-scopes#using-the-admin-consent-endpoint).</span><span class="sxs-lookup"><span data-stu-id="8f11f-176">For details, see [Using the admin consent endpoint](https://docs.microsoft.com/es-ES/azure/active-directory/develop/active-directory-v2-scopes#using-the-admin-consent-endpoint).</span></span>

<span data-ttu-id="8f11f-177">Para conceder permisos a una aplicación, necesitará lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="8f11f-177">To grant permissions to an application, you'll need:</span></span>

- <span data-ttu-id="8f11f-178">**Id. de aplicación**: el Id. de aplicación del portal de registro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-178">**Application ID** - The application ID from application registration portal.</span></span>
- <span data-ttu-id="8f11f-179">**Dirección URL de redireccionamiento**: la cadena que configure en el portal de registro de la aplicación de respuesta de autenticación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-179">**Redirect URL** - The string you set in the application registration portal for authentication response.</span></span>

<span data-ttu-id="8f11f-180">Para conceder los permisos:</span><span class="sxs-lookup"><span data-stu-id="8f11f-180">To grant the permissions:</span></span>

- <span data-ttu-id="8f11f-181">En un editor de texto, cree la siguiente cadena de dirección URL:</span><span class="sxs-lookup"><span data-stu-id="8f11f-181">In a text editor, create following URL string:</span></span>

    `https://login.microsoftonline.com/common/adminconsent?client_id=<Application Id>&state=12345&redirect_uri=<Redirect URL>`

- <span data-ttu-id="8f11f-182">En un navegador web, vaya a esta dirección URL e inicie sesión como administrador del espacio empresarial.</span><span class="sxs-lookup"><span data-stu-id="8f11f-182">In a web browser, go to this URL, and sign in as a tenant administrator.</span></span> <span data-ttu-id="8f11f-183">El cuadro de diálogo muestra la lista de permisos que necesita la aplicación, como se indica en el portal de registro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-183">The dialog box shows the list of permission the application requires, as specified in the application registration portal.</span></span> <span data-ttu-id="8f11f-184">Elija **Aceptar** para conceder estos permisos a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-184">Choose **OK** to grant the application these permissions.</span></span>

> <span data-ttu-id="8f11f-185">**Nota:** Este paso concede permisos a la aplicación, no a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="8f11f-185">**Note:** This step grants permissions to the application - not to users.</span></span> <span data-ttu-id="8f11f-186">Esto significa que a todos los usuarios que pertenezcan al espacio empresarial de Azure AD y que usen esta aplicación se les concederán los permisos, incluso a los usuarios que no son administradores.</span><span class="sxs-lookup"><span data-stu-id="8f11f-186">This means that all users belonging to the Azure AD tenant that use this application will be granted these permissions - even non-admin users.</span></span>

## <a name="assign-azure-ad-roles-to-users"></a><span data-ttu-id="8f11f-187">Asignar roles de Azure AD a usuarios</span><span class="sxs-lookup"><span data-stu-id="8f11f-187">Assign Azure AD roles to users</span></span>

<span data-ttu-id="8f11f-188">Después de que se conceden permisos a una aplicación, todos los usuarios con acceso a ella (es decir, los miembros del espacio empresarial de Azure AD) recibirán los permisos concedidos.</span><span class="sxs-lookup"><span data-stu-id="8f11f-188">After an application is granted permissions, everyone with access to the application (that is, members of the Azure AD tenant) will receive the granted permissions.</span></span> <span data-ttu-id="8f11f-189">Para proteger datos confidenciales de seguridad, la API de seguridad de Microsoft Graph también requiere que a los usuarios se les asigne el rol de **lector de seguridad** de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="8f11f-189">To further protect sensitive security data, the Microsoft Graph Security API also requires users to be assigned the Azure AD **Security Reader** role.</span></span> <span data-ttu-id="8f11f-190">Para obtener más información, consulte [Asignar roles de administrador](https://docs.microsoft.com/es-ES/azure/active-directory/active-directory-assign-admin-roles-azure-portal) y [Asignar un usuario a los roles de administrador](https://docs.microsoft.com/es-ES/azure/active-directory/active-directory-users-assign-role-azure-portal).</span><span class="sxs-lookup"><span data-stu-id="8f11f-190">For details, see [Assigning administrator roles](https://docs.microsoft.com/es-ES/azure/active-directory/active-directory-assign-admin-roles-azure-portal) and [Assign a user to adminstrator roles](https://docs.microsoft.com/es-ES/azure/active-directory/active-directory-users-assign-role-azure-portal).</span></span>

><span data-ttu-id="8f11f-191">**Nota:** Para realizar este paso, debe ser administrador de un espacio empresarial.</span><span class="sxs-lookup"><span data-stu-id="8f11f-191">**Note:** You must be a tenant admin to perform this step.</span></span>

<span data-ttu-id="8f11f-192">Para asignar roles a usuarios, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="8f11f-192">To assign roles to users:</span></span>

- <span data-ttu-id="8f11f-193">Inicie sesión en [Azure Portal](https://portal.azure.com) (https://portal.azure.com)).</span><span class="sxs-lookup"><span data-stu-id="8f11f-193">Sign in to the [azure portal](https://portal.azure.com) (https://portal.azure.com).</span></span>
- <span data-ttu-id="8f11f-194">En el menú, seleccione **Azure Active Directory** > **Usuarios**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-194">In the menu, select **Azure Active Directory** > **Users**.</span></span>
- <span data-ttu-id="8f11f-195">Seleccione el nombre del usuario.</span><span class="sxs-lookup"><span data-stu-id="8f11f-195">Select the name of the user.</span></span>
- <span data-ttu-id="8f11f-196">Seleccione **Administrar** > **Rol de directorio**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-196">Select **Manage** > **Directory role**.</span></span>
- <span data-ttu-id="8f11f-197">Seleccione **Administrador limitado**y elija la casilla de verificación **Lector de seguridad**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-197">Select **Limited administrator**, and choose the **Security reader** check box.</span></span>
- <span data-ttu-id="8f11f-198">Elija **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-198">Choose **Save**.</span></span>

## <a name="create-an-authentication-code"></a><span data-ttu-id="8f11f-199">Crear un código de autenticación</span><span class="sxs-lookup"><span data-stu-id="8f11f-199">Create an authentication code</span></span>

<span data-ttu-id="8f11f-200">Para crear un código de autenticación, necesitará lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="8f11f-200">To create an authentication code, you'll need:</span></span>

- <span data-ttu-id="8f11f-201">**Id. de aplicación**: el Id. de aplicación del portal de registro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-201">**Application ID** - The application ID from application registration portal.</span></span>
- <span data-ttu-id="8f11f-202">**Dirección URL de redirección**: la dirección URL desde donde se envía la respuesta de autenticación de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="8f11f-202">**Redirect URL** - The URL where the authentication response from Azure AD is sent.</span></span> <span data-ttu-id="8f11f-203">Para comenzar, puede usar https://localhost o la página principal de prueba de la aplicación web del cliente.</span><span class="sxs-lookup"><span data-stu-id="8f11f-203">To start, you can use https://localhost or the test client web app homepage.</span></span>
- <span data-ttu-id="8f11f-204">**Tecla de aplicación** (opcional): la tecla de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-204">**Application Key** (optional) - The key of the application.</span></span> <span data-ttu-id="8f11f-205">Esto se aplica al desarrollar una aplicación que usará el código de autenticación solo de la aplicación (es decir, que no admitirá la autenticación delegada por el usuario).</span><span class="sxs-lookup"><span data-stu-id="8f11f-205">This applies when you're developing an application that will use application-only authentication code (that is, will not support user delegated authentication).</span></span>

<span data-ttu-id="8f11f-206">En la siguiente tabla se indican los recursos que puede usar para crear un código de autenticación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-206">The following table lists resources that you can use to create an authentication code.</span></span>

|<span data-ttu-id="8f11f-207">**Tipo de aplicación**</span><span class="sxs-lookup"><span data-stu-id="8f11f-207">**Type of application**</span></span>|<span data-ttu-id="8f11f-208">**Biblioteca de autenticación**</span><span class="sxs-lookup"><span data-stu-id="8f11f-208">**Authentication library**</span></span>|
|------------------------|----------------------------|
|[<span data-ttu-id="8f11f-209">Aplicaciones de escritorio - iOS</span><span class="sxs-lookup"><span data-stu-id="8f11f-209">Desktop apps - iOS</span></span>](https://docs.microsoft.com/es-ES/azure/active-directory/develop/guidedsetups/active-directory-ios)|[<span data-ttu-id="8f11f-210">MSAL.framework: Biblioteca de autenticación de Microsoft (versión preliminar para iOS)</span><span class="sxs-lookup"><span data-stu-id="8f11f-210">MSAL.framework: Microsoft Authentication Library Preview for iOS</span></span>](https://github.com/AzureAD/microsoft-authentication-library-for-objc)|
|[<span data-ttu-id="8f11f-211">Aplicaciones de escritorio - Android</span><span class="sxs-lookup"><span data-stu-id="8f11f-211">Desktop apps - Android</span></span>](https://docs.microsoft.com/es-ES/azure/active-directory/develop/guidedsetups/active-directory-android)|[<span data-ttu-id="8f11f-212">Biblioteca de autenticación de Microsoft (MSAL)</span><span class="sxs-lookup"><span data-stu-id="8f11f-212">Microsoft Authentication Library (MSAL)</span></span>](https://javadoc.io/doc/com.microsoft.identity.client/msal)|
|[<span data-ttu-id="8f11f-213">Aplicaciones de escritorio - .Net</span><span class="sxs-lookup"><span data-stu-id="8f11f-213">Desktop apps - .Net</span></span>](https://docs.microsoft.com/es-ES/azure/active-directory/develop/guidedsetups/active-directory-windesktop)|[<span data-ttu-id="8f11f-214">Biblioteca de autenticación de Microsoft (MSAL)</span><span class="sxs-lookup"><span data-stu-id="8f11f-214">Microsoft Authentication Library (MSAL)</span></span>](https://www.nuget.org/packages/Microsoft.Identity.Client)|
|[<span data-ttu-id="8f11f-215">Aplicaciones web - JavaScript SPA</span><span class="sxs-lookup"><span data-stu-id="8f11f-215">Web apps - JavaScript SPA</span></span>](https://docs.microsoft.com/es-ES/azure/active-directory/develop/guidedsetups/active-directory-javascriptspa)|[<span data-ttu-id="8f11f-216">Biblioteca de autenticación de Microsoft para JavaScript (versión preliminar)</span><span class="sxs-lookup"><span data-stu-id="8f11f-216">Microsoft Authentication Library for JavaScript Preview</span></span>](https://github.com/AzureAD/microsoft-authentication-library-for-js)|
|[<span data-ttu-id="8f11f-217">Aplicaciones web - Servidor web de .NET</span><span class="sxs-lookup"><span data-stu-id="8f11f-217">Web apps - .NET Web Server</span></span>](https://docs.microsoft.com/es-ES/azure/active-directory/develop/guidedsetups/active-directory-aspnetwebapp)|<span data-ttu-id="8f11f-218">OpenIdConnection, Cookies, SystemWeb</span><span class="sxs-lookup"><span data-stu-id="8f11f-218">OpenIdConnection, Cookies, SystemWeb</span></span>|
|[<span data-ttu-id="8f11f-219">Aplicaciones web - aplicaciones web NodeJS</span><span class="sxs-lookup"><span data-stu-id="8f11f-219">Web apps - NodeJS Web App</span></span>](https://docs.microsoft.com/es-ES/azure/active-directory/develop/active-directory-v2-devquickstarts-node-web)||

<span data-ttu-id="8f11f-220">En el caso de las aplicaciones que no utilizan ninguna de las bibliotecas existentes, consulte [Obtener acceso en nombre de un usuario](auth-v2-user.md).</span><span class="sxs-lookup"><span data-stu-id="8f11f-220">For applications that don't use any of the existing libraries, see [Get access on behalf of a user](auth-v2-user.md).</span></span>

1. <span data-ttu-id="8f11f-221">Obtenga un código de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="8f11f-221">Get a code from Azure AD.</span></span> <span data-ttu-id="8f11f-222">La consulta a la llamada contiene el parámetro de Id. de aplicación, Dirección URL de redirección y **los permisos necesarios**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-222">The query to call contains parameter for Application ID, Redirect URl, and **required permissions**.</span></span>
2. <span data-ttu-id="8f11f-223">Use el código para obtener un token de acceso.</span><span class="sxs-lookup"><span data-stu-id="8f11f-223">Use the code to get an access token.</span></span>

<span data-ttu-id="8f11f-224">Si usa una biblioteca de OpenId Connect, consulte [Autenticarse con Azure AD y OpenID Connect](https://docs.microsoft.com/es-ES/azure/architecture/multitenant-identity/authenticate) y realice una llamada a `app.UseOpenIdConnectAuthentication()`.</span><span class="sxs-lookup"><span data-stu-id="8f11f-224">If you use OpenId Connect library, see [Authenticate using Azure AD and OpenID Connect](https://docs.microsoft.com/es-ES/azure/architecture/multitenant-identity/authenticate) and call `app.UseOpenIdConnectAuthentication()`.</span></span>

><span data-ttu-id="8f11f-225">**Nota:** Si está solicitando tokens de autenticación delegados por el usuario, el parámetro de la biblioteca es **Ámbitos solicitados**.</span><span class="sxs-lookup"><span data-stu-id="8f11f-225">**Note:** If you're requesting user delegated authentication tokens, the parameter for the library is **Requested Scopes**.</span></span> <span data-ttu-id="8f11f-226">Use "User.Read" para este parámetro en lugar de lo que requiere la aplicación registrada.</span><span class="sxs-lookup"><span data-stu-id="8f11f-226">Use User.Read for this parameter instead of what the registered application requires.</span></span> <span data-ttu-id="8f11f-227">El parámetro **Ámbitos solicitados** NO afecta a los permisos que contienen los tokens de autenticación que se muestran.</span><span class="sxs-lookup"><span data-stu-id="8f11f-227">The **Requested Scopes** parameter does NOT affect the permissions contained in the returned authentication tokens.</span></span> <span data-ttu-id="8f11f-228">Estos dependen de los permisos que el administrador del espacio empresarial concede a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-228">These are determined by the permissions that the tenant admin granted the application.</span></span>

<span data-ttu-id="8f11f-229">Por ejemplo, si usa la biblioteca de .NET MSAL, realice una llamada a lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="8f11f-229">For example, if you're using the .NET MSAL library, call the following:</span></span>

`var accessToken = (await client.AcquireTokenAsync(scopes)).AccessToken;`

><span data-ttu-id="8f11f-230">**Nota:** Este ejemplo debe utilizar los permisos con privilegios mínimos, como "User.Read".</span><span class="sxs-lookup"><span data-stu-id="8f11f-230">**Note:** This example should use the least privileged permission, such as User.Read.</span></span> <span data-ttu-id="8f11f-231">Sin embargo, el token de acceso que se muestre puede contener los permisos concedidos por el administrador del espacio empresarial para el espacio empresarial del usuario actual, como "User.Read.All" o "User.ReadWrite.All".</span><span class="sxs-lookup"><span data-stu-id="8f11f-231">However, the returned access token can contain permissions that were granted by the tenant admin for the current user tenant, such as User.Read.All or User.ReadWrite.All.</span></span>

<span data-ttu-id="8f11f-232">Azure AD muestra un token (cadena) que contiene su información de autenticación y los permisos que necesita la aplicación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-232">A token (string) is returned by Azure AD that contains your authentication information and the permissions required by the application.</span></span> <span data-ttu-id="8f11f-233">Asigne este token al encabezado HTTP como un token portador, tal como se muestra en el siguiente ejemplo.</span><span class="sxs-lookup"><span data-stu-id="8f11f-233">Assign this token to the HTTP header as a bearer token, as shown in the following example.</span></span>

`request.Headers.Authorization = new AuthenticationHeaderValue("bearer", accessToken);`

<span data-ttu-id="8f11f-234">Microsoft Graph validará la información que contenga este token y concederá o rechazará el acceso.</span><span class="sxs-lookup"><span data-stu-id="8f11f-234">Microsoft Graph will validate the information contained in this token and grant, or reject, access.</span></span>

<span data-ttu-id="8f11f-235">Para ver notificaciones incluidas en el token que se muestre, use la biblioteca "System.IdentityModel.Tokens.Jwt" de NuGet.</span><span class="sxs-lookup"><span data-stu-id="8f11f-235">To view claims contained in the returned token, use NuGet library System.IdentityModel.Tokens.Jwt.</span></span>

`JwtSecurityTokenHandler tokenHandler = new JwtSecurityTokenHandler();`</br>
`var securityToken = tokenHandler.ReadToken(accessToken) as JwtSecurityToken;`

<span data-ttu-id="8f11f-236">La respuesta de Microsoft Graph contiene un encabezado llamado "client-request-id", que es un GUID.</span><span class="sxs-lookup"><span data-stu-id="8f11f-236">The response from Microsoft Graph contains a header called client-request-id, which is a GUID.</span></span> <span data-ttu-id="8f11f-237">Si se rechaza el acceso, especifique este GUID cuando obtenga asistencia técnica en [Microsoft Tech Community](https://techcommunity.microsoft.com/t5/Microsoft-Graph-Security-API/ct-p/SecurityGraphAPI). De esta forma, podremos ayudarlo a investigar la causa de este error de autenticación.</span><span class="sxs-lookup"><span data-stu-id="8f11f-237">If access is denied, please specify this GUID when seeking support at [Microsoft Tech Community](https://techcommunity.microsoft.com/t5/Microsoft-Graph-Security-API/ct-p/SecurityGraphAPI), so we can help investigate the cause of this authentication failure.</span></span>
