# <a name="get-started-with-microsoft-graph-in-a-python-app"></a><span data-ttu-id="e5b62-101">Introducción a Microsoft Graph en una aplicación de Python</span><span class="sxs-lookup"><span data-stu-id="e5b62-101">Get started with Microsoft Graph in a Python app</span></span> 

<span data-ttu-id="e5b62-102">En este artículo, se describen las tareas necesarias para obtener un token de acceso desde Azure AD y llamar a Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e5b62-102">This article describes the tasks required to get an access token from Azure AD and call Microsoft Graph.</span></span> <span data-ttu-id="e5b62-103">Le muestra los pasos para [Enviar un correo electrónico a través de Microsoft Graph desde Python](https://github.com/microsoftgraph/python-sample-send-mail) y explica los conceptos principales que implementará para usar la API de Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e5b62-103">It walks you through [Sending mail via Microsoft Graph from Python](https://github.com/microsoftgraph/python-sample-send-mail) and explains the main concepts that you implement to use the Microsoft Graph API.</span></span> <span data-ttu-id="e5b62-104">El artículo describe cómo obtener acceso a Microsoft Graph mediante llamadas de REST directas.</span><span class="sxs-lookup"><span data-stu-id="e5b62-104">The article describes how to access Microsoft Graph by using direct REST calls.</span></span>

![Enviar formulario de correo electrónico](https://raw.githubusercontent.com/microsoftgraph/python-sample-send-mail/master/static/images/sendmail.png)

## <a name="choosing-an-authentication-library"></a><span data-ttu-id="e5b62-106">Selección de una biblioteca de autenticación</span><span class="sxs-lookup"><span data-stu-id="e5b62-106">Choosing an authentication library</span></span>

<span data-ttu-id="e5b62-107">Para realizar llamadas a Microsoft Graph, la aplicación debe obtener un token de acceso válido de Azure Active Directory (Azure AD), el servicio de identidad de nube de Microsoft, y el token se debe pasar de un encabezado HTTP con cada llamada a la API de REST de Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e5b62-107">To make calls to Microsoft Graph, your app must obtain a valid access token from Azure Active Directory (Azure AD), the Microsoft cloud identity service, and the token must be passed in an HTTP header with each call to the Microsoft Graph REST API.</span></span> <span data-ttu-id="e5b62-108">El método de autenticación de Graph se basa en los estándares de OAuth 2.0 y Open ID Connect, por lo que existen muchas [bibliotecas de autenticación](https://docs.microsoft.com/es-ES/azure/active-directory/develop/active-directory-v2-libraries) de las que puede elegir para implementar la autenticación en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="e5b62-108">Graph's approach to authentication is based on the OAuth 2.0 and Open ID Connect standards, so there are many [authentication libraries](https://docs.microsoft.com/es-ES/azure/active-directory/develop/active-directory-v2-libraries) that you can choose from to implement authentication in your application.</span></span>

<span data-ttu-id="e5b62-109">En el ejemplo siguiente se usa la biblioteca [Flask-OAuthlib](https://flask-oauthlib.readthedocs.io/en/latest/) para implementar el flujo de trabajo [Concesión de código de autorización](https://tools.ietf.org/html/rfc6749#section-4.1) de OAuth 2.0 , que es el flujo de trabajo de autenticación recomendado para las aplicaciones web escritas en Python.</span><span class="sxs-lookup"><span data-stu-id="e5b62-109">The sample covered below uses the [Flask-OAuthlib](https://flask-oauthlib.readthedocs.io/en/latest/) library to implement OAuth 2.0 [Authorization Code Grant](https://tools.ietf.org/html/rfc6749#section-4.1) workflow, which is the recommended auth workflow for web applications written in Python.</span></span> <span data-ttu-id="e5b62-110">Para obtener información sobre otras opciones de autenticación, vea [Ejemplos de autenticación de Python para Microsoft Graph](https://github.com/microsoftgraph/python-sample-auth).</span><span class="sxs-lookup"><span data-stu-id="e5b62-110">For information about other authentication options, see [Python authentication samples for Microsoft Graph](https://github.com/microsoftgraph/python-sample-auth).</span></span>

## <a name="installing-and-running-the-send-mail-sample"></a><span data-ttu-id="e5b62-111">Instalación y ejecución del ejemplo de envío de correos electrónicos</span><span class="sxs-lookup"><span data-stu-id="e5b62-111">Installing and running the send-mail sample</span></span>

<span data-ttu-id="e5b62-112">Para instalar y configurar la aplicación de ejemplo, siga las instrucciones de [Instalar los ejemplos de REST de Python](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md).</span><span class="sxs-lookup"><span data-stu-id="e5b62-112">To install and configure the sample app, follow the instructions in [Installing the Python REST samples](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md).</span></span> <span data-ttu-id="e5b62-113">Para el ejemplo de envío de correos electrónicos que se muestra a continuación, use este comando para clonar el repo:</span><span class="sxs-lookup"><span data-stu-id="e5b62-113">For the send-mail sample covered below, use this command to clone the repo:</span></span>

```git clone https://github.com/microsoftgraph/python-sample-send-mail.git```

<span data-ttu-id="e5b62-114">Al registrar la aplicación como se explica en las [instrucciones de instalación](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md), asegúrese de incluir los permisos **User.Read** y **Mail.Send**, que son necesarios para en este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="e5b62-114">When you register the application as covered in the [installation instructions](https://github.com/microsoftgraph/python-sample-auth/blob/master/installation.md), be sure to include the **User.Read** and **Mail.Send** permissions, which are required for this sample.</span></span>

<span data-ttu-id="e5b62-115">Después de completar la instalación o configuración, puede ejecutar la aplicación de ejemplo siguiendo las instrucciones de [ejecutar el ejemplo](https://github.com/microsoftgraph/python-sample-send-mail#running-the-sample).</span><span class="sxs-lookup"><span data-stu-id="e5b62-115">After completing the installation/configuration, you can run the sample app by following the instructions for [running the sample](https://github.com/microsoftgraph/python-sample-send-mail#running-the-sample).</span></span>

## <a name="code-walkthrough"></a><span data-ttu-id="e5b62-116">Tutorial de código</span><span class="sxs-lookup"><span data-stu-id="e5b62-116">Code walkthrough</span></span>

<span data-ttu-id="e5b62-117">La siguiente es una descripción general del [código fuente](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py) para la aplicación de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="e5b62-117">The following is an overview of the [source code](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py) for the sample app.</span></span>

<span data-ttu-id="e5b62-118">Las primeras líneas de código son las [importaciones](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L4-L32) de los paquetes y módulos de Python usados en este ejemplo:</span><span class="sxs-lookup"><span data-stu-id="e5b62-118">The first few lines of code are the [imports](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L4-L32) for the Python modules and packages used in the sample:</span></span>

* <span data-ttu-id="e5b62-119">El módulo **base64** de la biblioteca estándar se usa para codificar los datos adjuntos de correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="e5b62-119">The **base64** module from the standard library is used for encoding email attachments.</span></span>
* <span data-ttu-id="e5b62-120">El módulo **mimetypes** se usa para determinar el tipo MIME para archivos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="e5b62-120">The **mimetypes** module is used to determine the MIME type for file attachments.</span></span>
* <span data-ttu-id="e5b62-121">El módulo **os** proporciona funciones comunes del sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="e5b62-121">The **os** module provides common file system functionality.</span></span>
* <span data-ttu-id="e5b62-122">El módulo **pprint** de la biblioteca estándar se usa para imprimir con sangría los mensajes de error que devuelve Graph.</span><span class="sxs-lookup"><span data-stu-id="e5b62-122">The **pprint** module from the standard library is used to pretty-print any error messages returned by Graph.</span></span> <span data-ttu-id="e5b62-123">(Por ejemplo, si intenta enviar un mensaje de correo electrónico a una dirección no válida).</span><span class="sxs-lookup"><span data-stu-id="e5b62-123">(For example, if you try to send to an invalid email address.)</span></span>
* <span data-ttu-id="e5b62-124">El módulo **uuid** de la biblioteca estándar se usa para generar una cadena aleatoria de 36 caracteres para identificar exclusivamente cada solicitud de gráfico.</span><span class="sxs-lookup"><span data-stu-id="e5b62-124">The **uuid** module from the standard library is used to generate a random 36-character string to uniquely identify each Graph request.</span></span> <span data-ttu-id="e5b62-125">Esto puede resultar útil para propósitos de depuración.</span><span class="sxs-lookup"><span data-stu-id="e5b62-125">This can be useful for debugging purposes.</span></span>
* <span data-ttu-id="e5b62-126">El paquete **Flask** es el marco de la web para el ejemplo.</span><span class="sxs-lookup"><span data-stu-id="e5b62-126">The **flask** package is the web framework for the sample.</span></span>
* <span data-ttu-id="e5b62-127">La clase **OAuth** de **flask_oauthlib.client** es el empaquetador de la aplicación Flask que implementa el flujo de trabajo de autenticación de OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="e5b62-127">The **OAuth** class of **flask_oauthlib.client** is a wrapper around the Flask app that implements the OAuth 2.0 authentication workflow.</span></span>
* <span data-ttu-id="e5b62-128">El módulo **config** contiene la configuración de registro de la aplicación, como se ha configurado en el proceso de instalación anterior.</span><span class="sxs-lookup"><span data-stu-id="e5b62-128">The **config** module contains the application registration settings, as configured in the installation process above.</span></span>

<span data-ttu-id="e5b62-129">Después, se [crea una aplicación de Flask](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L15-L17) y el [objeto de cliente de Graph](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L19-L28), denominado **MSGRAPH**.</span><span class="sxs-lookup"><span data-stu-id="e5b62-129">Next, we [create a Flask app](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L15-L17) and then create the [Graph client object](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L19-L28), named **MSGRAPH**.</span></span>

<span data-ttu-id="e5b62-130">Después de estos pasos de configuración inicial, se usan tres funciones de controlador de ruta de Flask que implementan el flujo de trabajo de autenticación: [homepage()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L30-L33), [login()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L35-L39) y [authorized()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L41-L48).</span><span class="sxs-lookup"><span data-stu-id="e5b62-130">After those initial setup steps come three Flask route handler functions that implement the authentication workflow: [homepage()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L30-L33), [login()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L35-L39), and [authorized()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L41-L48).</span></span> <span data-ttu-id="e5b62-131">Para más información sobre el flujo de trabajo de autenticación, vea la sección [Arquitectura de ejemplo](https://github.com/microsoftgraph/python-sample-auth#sample-architecture) del repo de autenticación de Phyton.</span><span class="sxs-lookup"><span data-stu-id="e5b62-131">For more information about the authentication workflow, see the [Sample architecture](https://github.com/microsoftgraph/python-sample-auth#sample-architecture) section of the Python authentication samples repo.</span></span>

<span data-ttu-id="e5b62-132">El controlador de ruta siguiente, [mailform()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L50-L83), es el formulario donde se especifican los destinatarios, el asunto y el cuerpo del correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="e5b62-132">The next route handler, [mailform()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L50-L83), is the form where you specify email recipients, subject, and body.</span></span> <span data-ttu-id="e5b62-133">Tenga en cuenta que, en esta función, también se incluyen nuestras primeras llamadas a Graph, incluida la recuperación del perfil de usuario y la foto de perfil, la carga de la foto en OneDrive y la creación de un vínculo para compartir.</span><span class="sxs-lookup"><span data-stu-id="e5b62-133">Note that this function also includes our first calls to Graph, including retrieving the user profile and profile photo, uploading the photo to OneDrive, and creating a sharing link.</span></span> <span data-ttu-id="e5b62-134">Los datos se [pasan a la plantilla mailform.html](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L77-L83), donde se puede editar el destinatario, el asunto y el cuerpo antes de enviar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="e5b62-134">The data is [passed to the mailform.html template](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L77-L83), where the recipient, subject and body can be edited before sending the message.</span></span> 

<span data-ttu-id="e5b62-135">La siguiente función es [send_mail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L85-L107), que envía el correo electrónico y muestra la respuesta de la API de Graph.</span><span class="sxs-lookup"><span data-stu-id="e5b62-135">Next is the [send_mail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L85-L107) function, which sends the email and displays the response from the Graph API.</span></span> <span data-ttu-id="e5b62-136">Usa una función auxiliar sendmail(), y pasa a los parámetros de cadena de consulta que se publicaron desde el formulario:</span><span class="sxs-lookup"><span data-stu-id="e5b62-136">It uses a sendmail() helper function, passing to it the query string parameters that were posted from the form:</span></span>

```python
response = sendmail(client=MSGRAPH,
                    subject=flask.request.args['subject'],
                    recipients=flask.request.args['email'].split(';'),
                    body=flask.request.args['body'],
                    attachments=[profile_pic])
```

<span data-ttu-id="e5b62-137">La instancia de cliente Flask-OAuthlib (```MSGRAPH```) usa la función [get_token()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L109-L123) para obtener un token de acceso cuando al realizar llamadas a Graph.</span><span class="sxs-lookup"><span data-stu-id="e5b62-137">The [get_token()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L109-L123) function is used by the Flask-OAuthlib client instance (```MSGRAPH```) to obtain an access token whenever we make calls to Graph.</span></span> <span data-ttu-id="e5b62-138">Se pasa el token de acceso en un encabezado HTTP denominado **Autorización**, pero no es necesario hacer esto en el código.</span><span class="sxs-lookup"><span data-stu-id="e5b62-138">The access token is passed in an HTTP header named **Authorization**, but you don't need to deal with this in your code.</span></span> <span data-ttu-id="e5b62-139">Solo puede realizar llamadas a Graph con métodos de verbo HTTP del cliente (por ejemplo, get() o post()) y la instancia de cliente sabrá cómo llamar a ```get_token()``` para obtener un token, porque la función está [decorada](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L109-L109) con ```tokengetter```.</span><span class="sxs-lookup"><span data-stu-id="e5b62-139">You can simply make calls to Graph via the client's HTTP verb methods (for example, get() or post()), and the client instance will know to call ```get_token()``` to obtain a token, because the function is [decorated](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L109-L109) with ```tokengetter```.</span></span>

<span data-ttu-id="e5b62-140">El resto del ejemplo son funciones auxiliares que simplifican actividades comunes de Graph:</span><span class="sxs-lookup"><span data-stu-id="e5b62-140">The remainder of the sample is helper functions that simplify common Graph activities:</span></span>

* <span data-ttu-id="e5b62-141">[request_headers()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L114-L123) devuelve un diccionario de encabezados HTTP para que se envíen a cada llamada a Graph.</span><span class="sxs-lookup"><span data-stu-id="e5b62-141">[request_headers()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L114-L123) returns a dictionary of HTTP headers to be sent with each call to Graph.</span></span>
* <span data-ttu-id="e5b62-142">[profile_photo()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L125-L154) devuelve la foto de perfil del usuario y, de forma opcional guarda una copia en un archivo local.</span><span class="sxs-lookup"><span data-stu-id="e5b62-142">[profile_photo()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L125-L154) returns the user's profile photo and optionally saves a copy to a local file.</span></span>
* <span data-ttu-id="e5b62-143">[sendmail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L156-L202) envía un mensaje a el punto de conexión ```me/microsoft.graph.sendMail```.</span><span class="sxs-lookup"><span data-stu-id="e5b62-143">[sendmail()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L156-L202) sends a message using the ```me/microsoft.graph.sendMail``` endpoint.</span></span>
* <span data-ttu-id="e5b62-144">[sharing_link()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L204-L221) crea un vínculo para compartir de un elemento especificado en OneDrive.</span><span class="sxs-lookup"><span data-stu-id="e5b62-144">[sharing_link()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L204-L221) creates a sharing link for a specified item in OneDrive.</span></span>
* <span data-ttu-id="e5b62-145">[upload_file()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L223-L255) carga un archivo en OneDrive.</span><span class="sxs-lookup"><span data-stu-id="e5b62-145">[upload_file()](https://github.com/microsoftgraph/python-sample-send-mail/blob/master/sample.py#L223-L255) uploads a file to OneDrive.</span></span>

<span data-ttu-id="e5b62-146">Puede que estas funciones auxiliares le resulten útiles en otras aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="e5b62-146">You may find these helper functions useful in other applications.</span></span>

## <a name="other-python-rest-samples"></a><span data-ttu-id="e5b62-147">Otros ejemplos de REST de Python</span><span class="sxs-lookup"><span data-stu-id="e5b62-147">Other Python REST samples</span></span>

<span data-ttu-id="e5b62-148">Estos son otros ejemplos de Python donde se demuestra cómo trabajar con diferentes aspectos de Microsoft Graph:</span><span class="sxs-lookup"><span data-stu-id="e5b62-148">Here are some other Python samples that demonstrate how to work with various aspects of Microsoft Graph:</span></span>

* [<span data-ttu-id="e5b62-149">Ejemplos de autenticación de Python para Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e5b62-149">Python authentication samples for Microsoft Graph</span></span>](https://github.com/microsoftgraph/python-sample-auth)
* [<span data-ttu-id="e5b62-150">Trabajar con respuestas de Microsoft Graph paginadas en Python</span><span class="sxs-lookup"><span data-stu-id="e5b62-150">Working with paginated Microsoft Graph responses in Python</span></span>](https://github.com/microsoftgraph/python-sample-pagination)
* [<span data-ttu-id="e5b62-151">Trabajar con extensiones abiertas de Graph en Python</span><span class="sxs-lookup"><span data-stu-id="e5b62-151">Working with Graph open extensions in Python</span></span>](https://github.com/microsoftgraph/python-sample-open-extensions)
* [<span data-ttu-id="e5b62-152">Conectar una aplicación web de Python a la API para seguridad</span><span class="sxs-lookup"><span data-stu-id="e5b62-152">Connect a Python web app to the Security API</span></span>](https://github.com/microsoftgraph/python-security-rest-sample)

<span data-ttu-id="e5b62-153">Si hay un ejemplo concreto que le gustaría ver, [envíe un problema](https://github.com/microsoftgraph/python-sample-auth/issues) para hacérnoslo saber.</span><span class="sxs-lookup"><span data-stu-id="e5b62-153">If there's a particular sample you'd like to see, please let us know by [submitting an issue](https://github.com/microsoftgraph/python-sample-auth/issues).</span></span> <span data-ttu-id="e5b62-154">Estamos muy interesados en sus comentarios sobre cualquier escenario de Microsoft Graph que desee compilar en Python.</span><span class="sxs-lookup"><span data-stu-id="e5b62-154">We're very interested in your feedback on any Microsoft Graph scenario you'd like to build in Python!</span></span>

<span data-ttu-id="e5b62-155">La API de Microsoft Graph es una interfaz unificadora y muy avanzada que permite trabajar con todos los tipos de datos de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="e5b62-155">The Microsoft Graph API is a very powerful, unifiying API that can be used to interact with all kinds of Microsoft data.</span></span> <span data-ttu-id="e5b62-156">Consulte la [documentación de desarrollador](https://developer.microsoft.com/es-ES/graph/docs/concepts/overview) o el [Probador de Graph](https://developer.microsoft.com/es-ES/graph/graph-explorer) para explorar qué más puede realizar con Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e5b62-156">Check out the [developer documentation](https://developer.microsoft.com/es-ES/graph/docs/concepts/overview) or the [Graph Explorer](https://developer.microsoft.com/es-ES/graph/graph-explorer) to explore what else you can accomplish with Microsoft Graph.</span></span>
