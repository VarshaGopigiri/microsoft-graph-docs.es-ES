#  <a name="use-delta-query-to-track-changes-in-microsoft-graph-data"></a><span data-ttu-id="603f3-101">Usar la consulta delta para realizar el seguimiento de los cambios en datos de Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="603f3-101">Use delta query to track changes in Microsoft Graph data</span></span>

<span data-ttu-id="603f3-p101">La consulta de delta permite a las aplicaciones detectar entidades recién creadas, actualizadas o eliminadas sin realizar una operación de lectura completa del recurso de destino con cada solicitud. Las aplicaciones de Microsoft Graph pueden usar consultas de delta para sincronizar los cambios de forma eficaz con un almacén de datos local.</span><span class="sxs-lookup"><span data-stu-id="603f3-p101">Delta query enables applications to discover newly created, updated, or deleted entities without performing a full read of the target resource with every request. Microsoft Graph applications can use delta query to efficiently synchronize changes with a local data store.</span></span>

## <a name="use-delta-query-to-track-changes-in-a-resource-collection"></a><span data-ttu-id="603f3-104">Usar la consulta de delta para realizar el seguimiento de los cambios en una colección de recursos</span><span class="sxs-lookup"><span data-stu-id="603f3-104">Use delta query to track changes in a resource collection</span></span>

<span data-ttu-id="603f3-105">El patrón de llamada típico es el siguiente:</span><span class="sxs-lookup"><span data-stu-id="603f3-105">The typical call pattern is as follows:</span></span>

1.  <span data-ttu-id="603f3-106">La aplicación empieza con una llamada a una solicitud GET con la función delta en el recurso deseado.</span><span class="sxs-lookup"><span data-stu-id="603f3-106">The application begins by calling a GET request with the delta function on the desired resource.</span></span>
2.  <span data-ttu-id="603f3-107">Microsoft Graph envía una respuesta que contiene el recurso solicitado y un [token de estado](#state-tokens).</span><span class="sxs-lookup"><span data-stu-id="603f3-107">Microsoft Graph sends a response containing the requested resource and a [state token](#state-tokens).</span></span>

     <span data-ttu-id="603f3-p102">a.  Si se devuelve una dirección URL `nextLink`, podría haber más páginas de datos para recuperar en la sesión. La aplicación continúa realizando solicitudes mediante la dirección URL `nextLink` para recuperar todas las páginas de datos hasta que se incluya una dirección URL `deltaLink` en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="603f3-p102">a.  If a `nextLink` URL is returned, there may be additional pages of data to be retrieved in the session. The application continues making requests using the `nextLink` URL to retrieve all pages of data until a `deltaLink` URL is returned in the response.</span></span>

     <span data-ttu-id="603f3-p103">b.  Si se devuelve dirección URL `deltaLink`, no hay más datos sobre el estado existente del recurso para devolver. Para las solicitudes futuras, la aplicación usa la dirección URL `deltaLink` para obtener información sobre los cambios en el recurso.</span><span class="sxs-lookup"><span data-stu-id="603f3-p103">b.  If a `deltaLink` URL is returned, there is no more data about the existing state of the resource to be returned. For future requests, the application uses the `deltaLink` URL to learn about changes to the resource.</span></span>
     
3.  <span data-ttu-id="603f3-p104">Cuando la aplicación necesita obtener información sobre los cambios en el recurso, realiza una nueva solicitud con la dirección URL `deltaLink` recibida en el paso 2. Esta solicitud *puede* realizarse inmediatamente después de completar el paso 2, o cuando la aplicación comprueba los cambios.</span><span class="sxs-lookup"><span data-stu-id="603f3-p104">When the application needs to learn about changes to the resource, it makes a new request using the `deltaLink` URL received in step 2. This request *may* be made immediately after completing step 2 or when the application checks for changes.</span></span>
4.  <span data-ttu-id="603f3-116">Microsoft Graph devuelve una respuesta que describe los cambios en el recurso desde la solicitud anterior, y una dirección URL `nextLink` o `deltaLink`.</span><span class="sxs-lookup"><span data-stu-id="603f3-116">Microsoft Graph returns a response describing changes to the resource since the previous request, and either a `nextLink` URL or a `deltaLink` URL.</span></span>

### <a name="state-tokens"></a><span data-ttu-id="603f3-117">Tokens de estado</span><span class="sxs-lookup"><span data-stu-id="603f3-117">State tokens</span></span>

<span data-ttu-id="603f3-p105">Una respuesta GET de consulta de delta siempre incluye una dirección URL especificada en un encabezado de respuesta `nextLink` o `deltaLink`. La dirección URL `nextLink` incluye un _skipToken_ y una dirección URL `deltaLink` incluye un _deltaToken_.</span><span class="sxs-lookup"><span data-stu-id="603f3-p105">A delta query GET response always includes a URL specified in a `nextLink` or `deltaLink` response header. The `nextLink` URL includes a _skipToken_, and a `deltaLink` URL includes a _deltaToken_.</span></span> 

<span data-ttu-id="603f3-p106">Estos tokens son opacos para el cliente. A continuación se muestra la información que necesita saber sobre ellos:</span><span class="sxs-lookup"><span data-stu-id="603f3-p106">These tokens are opaque to the client. The following details are what you need to know about them:</span></span>

- <span data-ttu-id="603f3-122">Cada token refleja el estado y representa una instantánea del recurso en esa ronda de seguimiento de cambios.</span><span class="sxs-lookup"><span data-stu-id="603f3-122">Each token reflects the state and represents a snapshot of the resource in that round of change tracking.</span></span> 
- <span data-ttu-id="603f3-p107">Los tokens de estado también codifican e incluyen otros parámetros de consulta (como `$select`) especificados en la solicitud de consulta de delta inicial. Por lo tanto, no es necesario repetirlos en las solicitudes de consulta de delta siguientes.</span><span class="sxs-lookup"><span data-stu-id="603f3-p107">The state tokens also encode and include other query parameters (such as `$select`) specified in the initial delta query request. Therefore, it's not required to repeat them in subsequent delta query requests.</span></span>
- <span data-ttu-id="603f3-125">Al llevar a cabo consultas de delta, puede copiar y aplicar las direcciones URL `nextLink` o `deltaLink` a la siguiente llamada a función **delta** sin tener que examinar el contenido de la dirección URL, incluido su token de estado.</span><span class="sxs-lookup"><span data-stu-id="603f3-125">When carrying out delta query, you can copy and apply the `nextLink` or `deltaLink` URL to the next **delta** function call without having to inspect the contents of the URL, including its state token.</span></span>


### <a name="optional-query-parameters"></a><span data-ttu-id="603f3-126">Parámetros de consulta opcionales</span><span class="sxs-lookup"><span data-stu-id="603f3-126">Optional query parameters</span></span>

<span data-ttu-id="603f3-p108">Si un cliente usa un parámetro de consulta, debe especificarse en la solicitud inicial. Microsoft Graph codifica automáticamente el parámetro especificado en los `nextLink` o `deltaLink` proporcionados en la respuesta. La aplicación de llamada solo necesita especificar los parámetros de consulta deseados una vez por adelantado. Microsoft Graph agrega los parámetros especificados automáticamente para todas las solicitudes subsiguientes.</span><span class="sxs-lookup"><span data-stu-id="603f3-p108">If a client uses a query parameter, it must be specified in the initial request. Microsoft Graph automatically encodes the specified parameter into the `nextLink` or `deltaLink` provided in the response. The calling application only needs to specify their desired query parameters once upfront. Microsoft Graph adds the specified parameters automatically for all subsequent requests.</span></span>

<span data-ttu-id="603f3-131">Para los usuarios y grupos, existen restricciones en el uso de algunos parámetros de la consulta:</span><span class="sxs-lookup"><span data-stu-id="603f3-131">For users and groups, there are restrictions on using some query parameters:</span></span>

-   <span data-ttu-id="603f3-p109">Si se usa un parámetro de consulta `$select`, este indica que el cliente prefiere registrar los cambios solo en las propiedades o relaciones especificadas en la instrucción `$select`. Si se produce un cambio en una propiedad que no está activada, el recurso en el que se ha producido el cambio no aparecerá en la respuesta de delta tras una solicitud posterior.</span><span class="sxs-lookup"><span data-stu-id="603f3-p109">If a `$select` query parameter is used, the parameter indicates that the client prefers to only track changes on the properties or relationships specified in the `$select` statement. If a change occurs to a property that is not selected, the resource for which that property changed does not appear in the delta response after a subsequent request.</span></span>
-   <span data-ttu-id="603f3-134">`$expand` no es compatible.</span><span class="sxs-lookup"><span data-stu-id="603f3-134">`$expand` is not supported.</span></span>

<span data-ttu-id="603f3-p110">Para los usuarios y las API beta para grupos (vista previa), definir el ámbito de los filtros le permite controlar los cambios realizados en uno o más usuarios o grupos específicos mediante objectId. Por ejemplo, la siguiente solicitud: https://graph.microsoft.com/beta/groups/delta/?$filter= id eq '477e9fc6-5de7-4406-bb2a-7e5c83c9ae5f' o id eq '004d6a07-fe70-4b92-add5-e6e37b8acd8e' devuelve cambios para los grupos que coinciden con los id. especificados en el filtro de consulta.</span><span class="sxs-lookup"><span data-stu-id="603f3-p110">For users and groups beta (preview) APIs, scoping filters allow you to track changes to one or more specific users or groups by objectId. For example, the following request: https://graph.microsoft.com/beta/groups/delta/?$filter= id eq '477e9fc6-5de7-4406-bb2a-7e5c83c9ae5f' or id eq '004d6a07-fe70-4b92-add5-e6e37b8acd8e' returns changes for the groups matching the ids specified in the query filter.</span></span> 

## <a name="resource-representation-in-the-delta-query-response"></a><span data-ttu-id="603f3-137">Representación de recursos en la respuesta de consulta delta</span><span class="sxs-lookup"><span data-stu-id="603f3-137">Resource representation in the delta query response</span></span>

-   <span data-ttu-id="603f3-138">Las instancias de un recurso compatible recién creadas se representan en la respuesta de consulta de delta con su representación estándar.</span><span class="sxs-lookup"><span data-stu-id="603f3-138">Newly created instances of a supported resource are represented in the delta query response using their standard representation.</span></span>

-   <span data-ttu-id="603f3-139">Las instancias actualizadas están representadas por sus **id.** con *al menos* las propiedades que se han actualizado, pero pueden incluirse otras propiedades.</span><span class="sxs-lookup"><span data-stu-id="603f3-139">Updated instances are represented by their **id** with *at least* the properties that have been updated, but additional properties may be included.</span></span>

-   <span data-ttu-id="603f3-p111">Las relaciones de usuarios y grupos se representan como anotaciones en la representación de recursos estándar. Estas anotaciones utilizan el formato `propertyName@delta`. Las anotaciones se incluyen en la respuesta de la solicitud de consulta inicial de delta.</span><span class="sxs-lookup"><span data-stu-id="603f3-p111">Relationships on users and groups are represented as annotations on the standard resource representation. These annotations use the format `propertyName@delta`. The annotations are included in the response of the initial delta query request.</span></span>

<span data-ttu-id="603f3-p112">Las instancias eliminadas se representan mediante sus **id.** y un objeto `@removed`. El objeto `@removed` puede incluir información adicional sobre por qué se eliminó la instancia. Por ejemplo, "@removed": {"reason": "changed"}.</span><span class="sxs-lookup"><span data-stu-id="603f3-p112">Removed instances are represented by their **id** and an `@removed` object. The `@removed` object may include additional information about why the instance was removed. For example,  "@removed": {"reason": “changed”}.</span></span>

<span data-ttu-id="603f3-146">Las razones posibles de "@removed" (eliminación) pueden ser *changed* (cambios) o *deleted* (eliminaciones).</span><span class="sxs-lookup"><span data-stu-id="603f3-146">Possible @removed reasons can be *changed* or *deleted*.</span></span>
- <span data-ttu-id="603f3-147">*Changed* indica que el elemento se eliminó y puede restaurarse desde [deletedItems](../api-reference/beta/resources/directory.md).</span><span class="sxs-lookup"><span data-stu-id="603f3-147">*Changed* indicates the item was deleted and can be restored from [deletedItems](../api-reference/beta/resources/directory.md).</span></span>
- <span data-ttu-id="603f3-148">*Deleted* indica que el elemento se ha eliminado y no se puede restaurar.</span><span class="sxs-lookup"><span data-stu-id="603f3-148">*Deleted* indicates the item is deleted and cannot be restored.</span></span>

<span data-ttu-id="603f3-p113">Los objetos "@removed" se puede devolver en la respuesta de la consulta inicial de delta y en las respuestas de seguimiento (deltaLink). Los clientes con solicitudes de consulta delta deben diseñarse para manejar estos objetos en las respuestas.</span><span class="sxs-lookup"><span data-stu-id="603f3-p113">@removed object can be returned in the initial delta query response and in tracked (deltaLink) responses. Clients using delta query requests should be designed to handle these object in the responses.</span></span>

## <a name="supported-resources"></a><span data-ttu-id="603f3-151">Recursos admitidos</span><span class="sxs-lookup"><span data-stu-id="603f3-151">Supported resources</span></span>

<span data-ttu-id="603f3-152">Actualmente, la consulta delta es compatible con los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="603f3-152">Delta query is currently supported for the following resources:</span></span>

| <span data-ttu-id="603f3-153">**Colección de recursos**</span><span class="sxs-lookup"><span data-stu-id="603f3-153">**Resource collection**</span></span> | <span data-ttu-id="603f3-154">**API**</span><span class="sxs-lookup"><span data-stu-id="603f3-154">**API**</span></span> |
|:------ | :------ |
| <span data-ttu-id="603f3-155">Eventos en una vista de calendario (intervalo de fechas) del calendario principal</span><span class="sxs-lookup"><span data-stu-id="603f3-155">Events in a calendar view (date range) of the primary calendar</span></span> | <span data-ttu-id="603f3-156">La función [delta](../api-reference/v1.0/api/event_delta.md) del recurso [event](../api-reference/v1.0/resources/event.md)</span><span class="sxs-lookup"><span data-stu-id="603f3-156">[delta](../api-reference/v1.0/api/event_delta.md) function of the [event](../api-reference/v1.0/resources/event.md) resource</span></span> |
| <span data-ttu-id="603f3-157">Grupos</span><span class="sxs-lookup"><span data-stu-id="603f3-157">Groups</span></span> | <span data-ttu-id="603f3-158">La función [delta](../api-reference/v1.0/api/group_delta.md) del recurso [group](../api-reference/v1.0/resources/group.md)</span><span class="sxs-lookup"><span data-stu-id="603f3-158">[delta](../api-reference/v1.0/api/group_delta.md) function of the [group](../api-reference/v1.0/resources/group.md) resource</span></span> |
| <span data-ttu-id="603f3-159">Carpetas de correo</span><span class="sxs-lookup"><span data-stu-id="603f3-159">Mail folders</span></span> | <span data-ttu-id="603f3-160">La función [delta](../api-reference/v1.0/api/mailfolder_delta.md) del recurso [mailFolder](../api-reference/v1.0/resources/mailFolder.md)</span><span class="sxs-lookup"><span data-stu-id="603f3-160">[delta](../api-reference/v1.0/api/mailfolder_delta.md) function of the [mailFolder](../api-reference/v1.0/resources/mailFolder.md) resource</span></span> |
| <span data-ttu-id="603f3-161">Mensajes de una carpeta</span><span class="sxs-lookup"><span data-stu-id="603f3-161">Messages in a folder</span></span> | <span data-ttu-id="603f3-162">La función [delta](../api-reference/v1.0/api/message_delta.md) del recurso [message](../api-reference/v1.0/resources/message.md)</span><span class="sxs-lookup"><span data-stu-id="603f3-162">[delta](../api-reference/v1.0/api/message_delta.md) function of the [message](../api-reference/v1.0/resources/message.md) resource</span></span> | 
| <span data-ttu-id="603f3-163">Carpetas de contactos personales</span><span class="sxs-lookup"><span data-stu-id="603f3-163">Personal contact folders</span></span> | <span data-ttu-id="603f3-164">La función [delta](../api-reference/v1.0/api/contactfolder_delta.md) del recurso [contactFolder](../api-reference/v1.0/resources/contactfolder.md)</span><span class="sxs-lookup"><span data-stu-id="603f3-164">[delta](../api-reference/v1.0/api/contactfolder_delta.md) function of the [contactFolder](../api-reference/v1.0/resources/contactfolder.md) resource</span></span> |
| <span data-ttu-id="603f3-165">Contactos personales en una carpeta</span><span class="sxs-lookup"><span data-stu-id="603f3-165">Personal contacts in a folder</span></span> | <span data-ttu-id="603f3-166">La función [delta](../api-reference/v1.0/api/contact_delta.md) del recurso [contact](../api-reference/v1.0/resources/contact.md)</span><span class="sxs-lookup"><span data-stu-id="603f3-166">[delta](../api-reference/v1.0/api/contact_delta.md) function of the [contact](../api-reference/v1.0/resources/contact.md) resource</span></span> |
| <span data-ttu-id="603f3-167">Usuarios</span><span class="sxs-lookup"><span data-stu-id="603f3-167">Users</span></span> | <span data-ttu-id="603f3-168">La función [delta](../api-reference/v1.0/api/user_delta.md) del recurso [user](../api-reference/v1.0/resources/user.md)</span><span class="sxs-lookup"><span data-stu-id="603f3-168">[delta](../api-reference/v1.0/api/user_delta.md) function of the [user](../api-reference/v1.0/resources/user.md) resource</span></span> | 
| <span data-ttu-id="603f3-169">Elementos de la unidad\*</span><span class="sxs-lookup"><span data-stu-id="603f3-169">Drive items\*</span></span> | <span data-ttu-id="603f3-170">La función [delta](../api-reference/v1.0/api/item_delta.md) del recurso [driveItem](../api-reference/v1.0/resources/driveItem.md)</span><span class="sxs-lookup"><span data-stu-id="603f3-170">[delta](../api-reference/v1.0/api/item_delta.md) function of the [driveItem](../api-reference/v1.0/resources/driveItem.md) resource</span></span> |


> <span data-ttu-id="603f3-p114">\* El patrón de uso para los recursos de OneDrive es similar a los demás recursos compatibles con algunas diferencias secundarias de sintaxis. La consulta delta para unidades se actualizará en el futuro para que sea coherente con otros tipos de recursos. Para obtener más detalles sobre la sintaxis actual, vea: <https://developer.microsoft.com/en-us/graph/docs/api-reference/v1.0/api/item_delta></span><span class="sxs-lookup"><span data-stu-id="603f3-p114">\* The usage pattern for OneDrive resources is similar to the other supported resources with some minor syntax differences. Delta query for drives will be updated in the future to be consistent with other resource types. For more detail about the current syntax, please see: <https://developer.microsoft.com/en-us/graph/docs/api-reference/v1.0/api/item_delta></span></span>

## <a name="prerequisites"></a><span data-ttu-id="603f3-174">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="603f3-174">Prerequisites</span></span>

<span data-ttu-id="603f3-175">Los mismos [permisos](./permissions_reference.md) que se requieren para leer un recurso específico también son necesarios para realizar la consulta delta en ellos.</span><span class="sxs-lookup"><span data-stu-id="603f3-175">The same [permissions](./permissions_reference.md) that are required to read a specific resource are also required to perform delta query on that resource.</span></span>

## <a name="delta-query-request-examples"></a><span data-ttu-id="603f3-176">Ejemplos de solicitud de consulta delta</span><span class="sxs-lookup"><span data-stu-id="603f3-176">Delta query request examples</span></span> 

- [<span data-ttu-id="603f3-177">Obtener los cambios incrementales en los eventos en una vista de calendario</span><span class="sxs-lookup"><span data-stu-id="603f3-177">Get incremental changes to events in a calendar view</span></span>](../concepts/delta_query_events.md)
- [<span data-ttu-id="603f3-178">Obtener los cambios incrementales en los mensajes de una carpeta</span><span class="sxs-lookup"><span data-stu-id="603f3-178">Get incremental changes to messages in a folder</span></span>](./delta_query_messages.md)
- [<span data-ttu-id="603f3-179">Obtener los cambios incrementales en los grupos</span><span class="sxs-lookup"><span data-stu-id="603f3-179">Get incremental changes to groups</span></span>](./delta_query_groups.md)
- [<span data-ttu-id="603f3-180">Obtener los cambios incrementales en los usuarios</span><span class="sxs-lookup"><span data-stu-id="603f3-180">Get incremental changes to users</span></span>](./delta_query_users.md)
